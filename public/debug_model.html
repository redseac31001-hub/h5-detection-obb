<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¨¡å‹è°ƒè¯•å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@4.15.0/dist/tf-backend-webgl.min.js"></script>
</head>
<body>
    <h1>YOLO æ¨¡å‹è°ƒè¯•</h1>
    <div id="output"></div>

    <script>
        async function debugModel() {
            const output = document.getElementById('output');
            
            try {
                output.innerHTML += '<p>ğŸ”„ æ­£åœ¨åŠ è½½æ¨¡å‹...</p>';
                
                await tf.ready();
                console.log('TensorFlow.js åç«¯:', tf.getBackend());
                
                const model = await tf.loadGraphModel('/public/models/yolodetection/model.json');
                
                output.innerHTML += '<p>âœ… æ¨¡å‹åŠ è½½æˆåŠŸ</p>';
                
                // è¯¦ç»†æ£€æŸ¥æ¨¡å‹ç»“æ„
                console.log('å®Œæ•´æ¨¡å‹å¯¹è±¡:', model);
                console.log('æ¨¡å‹è¾“å…¥:', model.inputs);
                console.log('æ¨¡å‹è¾“å‡º:', model.outputs);
                console.log('è¾“å…¥èŠ‚ç‚¹:', model.inputNodes);
                console.log('è¾“å‡ºèŠ‚ç‚¹:', model.outputNodes);
                
                output.innerHTML += `<p><strong>è¾“å…¥æ•°é‡:</strong> ${model.inputs.length}</p>`;
                output.innerHTML += `<p><strong>è¾“å‡ºæ•°é‡:</strong> ${model.outputs.length}</p>`;
                
                // æ£€æŸ¥æ¯ä¸ªè¾“å…¥
                model.inputs.forEach((input, i) => {
                    console.log(`è¾“å…¥ ${i}:`, input);
                    output.innerHTML += `<p><strong>è¾“å…¥ ${i}:</strong> å½¢çŠ¶ ${JSON.stringify(input.shape)}, åç§°: ${input.name || 'N/A'}</p>`;
                });
                
                // æ£€æŸ¥æ¯ä¸ªè¾“å‡º
                model.outputs.forEach((output_tensor, i) => {
                    console.log(`è¾“å‡º ${i}:`, output_tensor);
                    output.innerHTML += `<p><strong>è¾“å‡º ${i}:</strong> å½¢çŠ¶ ${JSON.stringify(output_tensor.shape)}, åç§°: ${output_tensor.name || 'N/A'}</p>`;
                });
                
                // å°è¯•æ¨ç†æµ‹è¯•
                output.innerHTML += '<p>ğŸ§ª æ­£åœ¨è¿›è¡Œæ¨ç†æµ‹è¯•...</p>';
                const testInput = tf.randomNormal([1, 640, 640, 3]);
                console.log('æµ‹è¯•è¾“å…¥å½¢çŠ¶:', testInput.shape);
                
                const prediction = model.predict(testInput);
                console.log('é¢„æµ‹ç»“æœ:', prediction);
                
                if (Array.isArray(prediction)) {
                    output.innerHTML += `<p><strong>è¾“å‡ºç±»å‹:</strong> Array, é•¿åº¦: ${prediction.length}</p>`;
                    prediction.forEach((pred, i) => {
                        console.log(`é¢„æµ‹è¾“å‡º ${i}:`, pred);
                        output.innerHTML += `<p><strong>é¢„æµ‹è¾“å‡º ${i}:</strong> å½¢çŠ¶ ${JSON.stringify(pred.shape)}</p>`;
                    });
                } else {
                    console.log('å•ä¸€é¢„æµ‹è¾“å‡º:', prediction);
                    output.innerHTML += `<p><strong>é¢„æµ‹è¾“å‡ºå½¢çŠ¶:</strong> ${JSON.stringify(prediction.shape)}</p>`;
                }
                
                // æ¸…ç†
                testInput.dispose();
                if (Array.isArray(prediction)) {
                    prediction.forEach(p => p.dispose());
                } else {
                    prediction.dispose();
                }
                
                output.innerHTML += '<p>âœ… è°ƒè¯•å®Œæˆ</p>';
                
            } catch (error) {
                console.error('è°ƒè¯•å¤±è´¥:', error);
                output.innerHTML += `<p>âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        window.addEventListener('load', debugModel);
    </script>
</body>
</html>